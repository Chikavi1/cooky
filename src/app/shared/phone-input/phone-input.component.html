<div class="phone-input w-full" tabindex="0">
    <button
      type="button"
      class="flag-btn"
      (click)="toggleDropdown()"
      [disabled]="disabled"
      [attr.aria-expanded]="dropdownOpen"
    >
      <span class="flag">{{ selectedCountry.flag }}</span>
      <span class="arrow" [class.open]="dropdownOpen">▾</span>
    </button>

    <input
      type="tel"
      class="phone-field"
      placeholder="Número de teléfono"
      [value]="phone"
      [disabled]="disabled"
      (input)="onInputChange($event)"
      (blur)="onTouched()"
    />
    <ul
      *ngIf="dropdownOpen"
      class="dropdown"
      role="listbox"
      tabindex="-1"
    >
      <li class="search-box">
        <input
          type="text"
          placeholder="Buscar país o lada..."
          [(ngModel)]="searchTerm"
          (input)="onSearchChange()"
          #searchInput
        />
      </li>

      <li
        *ngFor="let country of filteredCountries"
        (click)="selectCountry(country)"
        role="option"
        [attr.aria-selected]="country.code === selectedCountry.code"
        tabindex="0"
      >
        <span class="flag">{{ country.flag }}</span>
        <span class="name">{{ country.name }}</span>
        <span class="dial">{{ country.dialCode }}</span>
      </li>

      <li *ngIf="filteredCountries.length === 0" class="no-results">
        No se encontraron países
      </li>
    </ul>

  </div>
  <p *ngIf="!isValid && phone.length > 0" class="text-red-600 mt-1 text-xs mr-2">
      Número inválido para {{ selectedCountry.name }}
    </p>
